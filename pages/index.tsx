import type { NextPage } from 'next';
import Head from 'next/head';

import styles from '../styles/Home.module.css';
import { Category } from '../src/components/Category';
import { FloatingButton } from '../src/components/Buttons';
import { useHome } from '../src/hooks/useHome';
import { BaseModal, ModalBody, ModalHeader } from '../src/components/Modals';
import { NomineeCard } from '../src/components/NomineeCard';

const Home: NextPage = () => {
  const controller = useHome();

  return (
    <div>
      <Head>
        <title>Take Home Test</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main>
        <h2 className={styles.pageTitle}>AWARDS 2021</h2>
        <div className={styles.categoriesContainer}>
          {controller.isLoadingBallot ? (
            <div style={{ textAlign: 'center' }}>
              Loading Ballots, please wait...
            </div>
          ) : controller.ballotsError ? (
            <div style={{ textAlign: 'center' }}>
              An Error: {JSON.stringify(controller.ballotsError)}
            </div>
          ) : controller.hasBallots ? (
            controller.ballots.map((ballot) => (
              <Category
                key={ballot.id}
                ballot={ballot}
                onSelectNominee={controller.onSelectNomineeCategory(
                  ballot.id,
                  ballot.title,
                )}
                selectedNomineeCategory={controller.selectedNomineeData.find(
                  (item) => item.categoryId === ballot.id,
                )}
              />
            ))
          ) : (
            <div style={{ textAlign: 'center' }}>No ballots found</div>
          )}
        </div>
        <FloatingButton
          disabled={!controller.hasSelectedNominees}
          title={
            controller.hasSelectedNominees
              ? 'Click to submit your vote'
              : 'Please select at least one nominee'
          }
          onClick={controller.onSubmitVote}
        >
          SUBMIT BALLOT
        </FloatingButton>
        <BaseModal
          isOpen={controller.isModalOpen}
          onDismiss={controller.onCloseModal}
        >
          <ModalHeader modalTitle="Voting Successful!"></ModalHeader>
          <ModalBody>
            <div>
              <h3 className={styles.yourVoteTitle}>Your Votes</h3>

              {controller.selectedNomineeData.map((item) => (
                <div key={item.categoryId}>
                  <h4 className={styles.categoryTitle}>
                    In {item.categoryTitle}
                  </h4>
                  <NomineeCard nominee={item.nominee} />
                </div>
              ))}
            </div>
          </ModalBody>
        </BaseModal>
      </main>
    </div>
  );
};

export default Home;
